{% extends 'base.html' %}
{% block content %}
<div class="container py-5">
  <h2 class="mb-4">Company Chat</h2>
  <div class="card p-4">
    <div id="chat-window" class="mb-3 border rounded p-3" style="height:300px; overflow-y:auto; background:#f8f9fa;"></div>
    <div class="input-group">
      <input type="text" id="chat-input" class="form-control" placeholder="Type your message...">
      <button id="send-btn" class="btn btn-primary">Send</button>
    </div>
  </div>
</div>
<script>
const companyId = "{{ company.id }}";
const username = "{{ user.username }}";
const chatSocket = new WebSocket(
  'ws://' + window.location.host + '/ws/chat/' + companyId + '/'
);
chatSocket.onmessage = function(e) {
  const data = JSON.parse(e.data);
  const chatWindow = document.getElementById('chat-window');
  const msgDiv = document.createElement('div');
  msgDiv.innerHTML = `<strong>${data.username}</strong> <span class='text-muted small'>${data.timestamp}</span><br>${data.message}`;
  chatWindow.appendChild(msgDiv);
  chatWindow.scrollTop = chatWindow.scrollHeight;
};
document.getElementById('send-btn').onclick = function() {
  const input = document.getElementById('chat-input');
  const message = input.value;
  if (message.trim() !== '') {
    chatSocket.send(JSON.stringify({ 'message': message }));
    input.value = '';
  }
};
</script>
{% endblock %}
